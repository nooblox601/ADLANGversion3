<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>ADLANG Community Platform</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; margin:0; padding:0; }
header { background:#222; color:#fff; padding:15px; text-align:center; }
.container { max-width:900px; margin:20px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2);}
button { padding:8px 12px; border:none; border-radius:5px; background:#28a745; color:#fff; cursor:pointer; margin-left:5px; }
button:hover { background:#218838; }
.language { border:1px solid #ddd; padding:10px; margin-bottom:10px; border-radius:5px; display:flex; justify-content:space-between; align-items:center; }
input[type=text], textarea { padding:6px; border:1px solid #ccc; border-radius:5px; width:200px; margin-right:10px; }
textarea { width:100%; resize:none; }
h2 { margin-top:30px; }
.forum-post { border:1px solid #ccc; padding:8px; margin-bottom:5px; border-radius:5px; background:#fafafa; }
</style>
</head>
<body>

<header>
<h1>ADLANG Community Platform</h1>
</header>

<div class="container">
<div id="loginStatus">Não logado</div>
<button id="loginBtn">Login com GitHub</button>

<h2>Linguagens Públicas</h2>
<div id="languages"></div>

<h3>Adicionar Nova Linguagem</h3>
<input type="text" id="langName" placeholder="Nome da linguagem">
<input type="text" id="langRepo" placeholder="URL do GitHub repo">
<button id="addLang">Adicionar Linguagem</button>

<h2>Forum & Updates</h2>
<div id="forumPosts"></div>
<textarea id="forumText" placeholder="Escreva uma mensagem"></textarea><br>
<button id="addPost">Postar</button>
</div>

<script>
// CONFIGURAÇÃO
const CLIENT_ID = "SEU_CLIENT_ID"; // GitHub OAuth App
const GIST_ID = "SEU_GIST_PUBLICO_ID"; // Gist que armazena linguagens e fórum
const GIST_FILENAME = "adlang_data.json";

let user = localStorage.getItem('github_user');
let token = localStorage.getItem('github_token');

const loginStatus = document.getElementById('loginStatus');
const loginBtn = document.getElementById('loginBtn');

function updateLoginUI() {
  if(user) {
    loginStatus.innerHTML = "Logado como: " + user;
    loginBtn.style.display = "none";
  } else {
    loginStatus.innerHTML = "Não logado";
    loginBtn.style.display = "inline-block";
  }
}

// Login GitHub real
loginBtn.onclick = function() {
  const url = `https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}&scope=gist`;
  window.location.href = url;
}

// Captura code do GitHub
const params = new URLSearchParams(window.location.search);
if(params.has("code")) {
  const code = params.get("code");
  // Aqui você precisaria trocar code por token usando backend seguro (não expor CLIENT_SECRET no JS)
  alert("Para login real, crie um backend que troque code por token. Por segurança, não use CLIENT_SECRET no JS.");
}

// Funções utilitárias para Gist
async function getGistData() {
  const res = await fetch(`https://api.github.com/gists/${GIST_ID}`);
  const gist = await res.json();
  return JSON.parse(gist.files[GIST_FILENAME].content);
}

async function updateGistData(newData) {
  if(!token) { alert("Faça login via GitHub para modificar dados!"); return; }
  await fetch(`https://api.github.com/gists/${GIST_ID}`, {
    method: "PATCH",
    headers: {
      "Authorization": "token " + token,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      files: {
        [GIST_FILENAME]: { content: JSON.stringify(newData, null, 2) }
      }
    })
  });
}

// Render linguagens
async function renderLanguages() {
  const data = await getGistData();
  const container = document.getElementById('languages');
  container.innerHTML = "";
  data.languages.forEach(lang => {
    const div = document.createElement('div');
    div.className = "language";
    div.innerHTML = `<span>${lang.name} (por ${lang.author})</span>
                     <div>
                     <a href="${lang.repo}/archive/refs/heads/main.zip" target="_blank"><button>Baixar Repo</button></a>
                     </div>`;
    container.appendChild(div);
  });
}

// Render forum
async function renderForum() {
  const data = await getGistData();
  const container = document.getElementById('forumPosts');
  container.innerHTML = "";
  data.forum.forEach(post => {
    const div = document.createElement('div');
    div.className = "forum-post";
    div.innerHTML = `<strong>${post.user}</strong>: ${post.text}`;
    container.appendChild(div);
  });
}

// Adicionar linguagem
document.getElementById('addLang').onclick = async function() {
  if(!user) { alert("Faça login para adicionar linguagens!"); return; }
  const name = document.getElementById('langName').value.trim();
  const repo = document.getElementById('langRepo').value.trim();
  if(!name || !repo) { alert("Preencha todos os campos!"); return; }
  const data = await getGistData();
  data.languages.push({name:name, repo:repo, author:user});
  await updateGistData(data);
  renderLanguages();
}

// Adicionar post no fórum
document.getElementById('addPost').onclick = async function() {
  if(!user) { alert("Faça login para postar!"); return; }
  const text = document.getElementById('forumText').value.trim();
  if(!text) return;
  const data = await getGistData();
  data.forum.push({user:user,text:text});
  await updateGistData(data);
  renderForum();
  document.getElementById('forumText').value = "";
}

// Inicial
renderLanguages();
renderForum();
updateLoginUI();
</script>

</body>
</html>

